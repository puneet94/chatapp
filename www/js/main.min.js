!function(e){"use strict";var t=e.module("petal",["ionic","satellizer","ngFileUpload","btford.socket-io","ngCordova","toastr","petal.home","petal.post","petal.chat","petal.user","petal.people"]);t.config(["$urlRouterProvider","$stateProvider","$ionicConfigProvider",function(e,t,o){o.tabs.position("bottom"),e.otherwise("/home/post/nearby")}]),t.run(["$rootScope","$state","$ionicPlatform","$ionicLoading","RequestsService","$cordovaPushV5","$ionicHistory",function(e,t,o,n,a,i,r){function s(){o.registerBackButtonAction(function(t){return e.backButtonPressedOnceToExit?ionic.Platform.exitApp():r.backView()?r.goBack():(e.backButtonPressedOnceToExit=!0,window.plugins.toast.showShortCenter("Press back button again to exit",function(e){},function(e){}),window.setTimeout(function(){e.backButtonPressedOnceToExit=!1},2e3)),t.preventDefault(),!1},101)}function c(){var t={android:{senderID:"679461840115"},ios:{alert:"true",badge:"true",sound:"true"},windows:{}};i.initialize(t).then(function(){i.onNotification(),i.onError(),i.register().then(function(e){a.register(e).then(function(e){})})}),e.$on("$cordovaPushV5:notificationReceived",function(e,t){}),e.$on("$cordovaPushV5:errorOcurred",function(e,t){console.log(e),console.log(t)})}o.ready(function(){window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault(),c(),s(),e.$on("$stateChangeStart",function(){n.show()})})}])}(window.angular),function(e){"use strict";function t(e){e.state("home.chat",{url:"/chat",abstract:!0,views:{"chat-tab":{templateUrl:"app/chat/views/chatParent.html",controller:"ChatParentController",controllerAs:"ppc"}}}).state("home.chat.all",{url:"/all",views:{"chat-tab":{templateUrl:"app/chat/views/allChat.html",controller:"AllChatController",controllerAs:"acc"}}}).state("home.chat.revealed",{url:"/revealed",views:{"chat-tab":{templateUrl:"app/chat/views/revealedChat.html",controller:"RevealedChatController",controllerAs:"rpc"}}}).state("chatBox",{url:"/chatBox/:user",templateUrl:"app/chat/views/chatBox.html",controller:"ChatBoxController",controllerAs:"cbc"})}e.module("petal.chat",["ngFileUpload"]).config(["$stateProvider",t])}(window.angular),function(e){"use strict";function t(e,t){var n="https://banana-surprise-31332.herokuapp.com/authenticate";t.facebook({clientId:"1134208830041632",url:n+"/auth/facebook",redirectUri:"https://banana-surprise-31332.herokuapp.com/"}),t.google({clientId:"742676837265-33jntkd60p87gkrh48nqe6cdd8ntsfl5.apps.googleusercontent.com",url:n+"/auth/google",redirectUri:"http://localhost:8100"}),e.state("authenticate",{url:"/authenticate",controller:"AuthenticationController",controllerAs:"ac",templateUrl:"app/home/views/authenticationPage.html"}).state("home",{url:"/home",abstract:!0,templateUrl:"app/home/views/tabs.html",controller:"HomeController",controllerAs:"hc",resolve:{redirectIfUserNotAuthenticated:["$q","$auth","$state","$timeout",o]}})}function o(e,t,o,n){var a=e.defer();return t.isAuthenticated()?a.resolve():(console.log("not audsnf"),n(function(){o.go("authenticate")})),a.promise}e.module("petal.home",[]).config(["$stateProvider","$authProvider",t])}(window.angular),function(e){"use strict";function t(e){e.state("home.people",{url:"/people",abstract:!0,views:{"people-tab":{templateUrl:"app/people/views/peopleParent.html",controller:"PeopleParentController",controllerAs:"ppc"}}}).state("home.people.all",{url:"/all",views:{"people-tab":{templateUrl:"app/people/views/allPeople.html",controller:"AllPeopleController",controllerAs:"apc"}}}).state("home.people.revealed",{url:"/revealed",views:{"people-tab":{templateUrl:"app/people/views/revealedPeople.html",controller:"RevealedPeopleController",controllerAs:"rpc"}}}).state("home.people.received",{url:"/received",views:{"people-tab":{templateUrl:"app/people/views/receivedPeople.html",controller:"ReceivedPeopleController",controllerAs:"rpc"}}}).state("home.people.nearby",{url:"/nearby",views:{"people-tab":{templateUrl:"app/people/views/nearbyPeople.html",controller:"NearbyPeopleController",controllerAs:"npc"}}})}e.module("petal.people",[]).config(["$stateProvider",t])}(window.angular),function(e){"use strict";function t(e){e.state("home.post",{url:"/post",abstract:!0,views:{"post-tab":{templateUrl:"app/post/views/postParent.html",controller:"PostParentController",controllerAs:"ppc"}}}).state("home.post.all",{url:"/all",views:{"post-tab":{templateUrl:"app/post/views/allPost.html",controller:"AllPostController",controllerAs:"apc"}}}).state("home.post.latest",{url:"/latest",views:{"post-tab":{templateUrl:"app/post/views/latestPost.html",controller:"LatestPostController",controllerAs:"lpc"}}}).state("home.post.popular",{url:"/popular",views:{"post-tab":{templateUrl:"app/post/views/popularPost.html",controller:"PopularPostController",controllerAs:"ppc"}}}).state("home.post.nearby",{url:"/nearby",views:{"post-tab":{templateUrl:"app/post/views/nearbyPost.html",controller:"NearbyPostController",controllerAs:"npc"}}}).state("postSubmit",{url:"/submit",templateUrl:"app/post/views/createPost.html",controller:"CreatePostController",controllerAs:"cpc"}).state("singlePost",{url:"/post/:id",templateUrl:"app/post/views/singlePost.html",controller:"SinglePostController",controllerAs:"spc"})}e.module("petal.post",[]).config(["$stateProvider",t])}(window.angular),function(e){"use strict";function t(e,t){return t.check(e.user).then(function(e){return e.data})}e.module("petal.user",[]).config(["$stateProvider",function(e){e.state("home.user",{url:"/user",abstract:!0,views:{"user-tab":{templateUrl:"app/user/views/userParentPage.html",controller:"UserParentController",controllerAs:"upc"}}}).state("home.userPage",{url:"/userPage/:user",resolve:{friends:["$stateParams","revealService",t]},views:{"extra-tab":{templateUrl:"app/user/views/userProfilePage.html",controller:"UserPageController",controllerAs:"upc"}}}).state("home.user.userMePage",{url:"/userMePage",views:{"user-tab":{templateUrl:"app/user/views/userMePage.html",controller:"UserMePageController",controllerAs:"umpc"}}}).state("home.userEditPage",{url:"/userEditPage",views:{"extra-tab":{templateUrl:"app/user/views/userEditPage.html",controller:"UserEditPageController",controllerAs:"uepc"}}})}])}(window.angular),function(e){"use strict";function t(t,o,n,a){function i(){c.params.page=1,c.chatRoomsList=[],s()}function r(){c.params.page+=1,s()}function s(){n.getAllChatRooms(c.params).then(function(t){e.forEach(t.data.docs,function(e){c.chatRoomsList.push(e)})}).finally(function(){a.hide()})}var c=this;c.params={page:1,limit:25},c.chatRoomsList=[],c.getAllChatRooms=s,c.loadMoreChats=r,c.pullRefreshChats=i,function(){s()}()}e.module("petal.chat").controller("AllChatController",["$scope","$state","chatService","$ionicLoading",t])}(window.angular),function(e){"use strict";function t(t,o,n,a,i,r,s,c,l,u,p,d){function f(){U.params.page+=1,g()}function h(){u.getUser(U.receiverUserID).then(function(e){U.receiverUser=e.data}).catch(function(e){window.alert(e),console.log(e)})}function m(){o(function(){l.scrollBottom(!0)})}function g(){c.getChatMessages(U.chatRoomId,U.params).then(function(t){e.forEach(t.data.docs,function(e){U.chatList.unshift(e)})}).catch(function(e){window.alert(JSON.stringify(e)),console.log(e)}).finally(function(){m(),t.$broadcast("scroll.refreshComplete"),d.hide()})}function v(e){t.currentImage=e,t.modal.show()}function w(){n.fromTemplateUrl("app/chat/views/chatImageModal.html",{scope:t}).then(function(e){t.modal=e})}function b(){a.emit("addToChatRoom",{roomId:U.chatRoomId}),a.on("messageReceived",function(e){m(),U.chatList.push(e),U.messageLoading=!1}),a.on("messageSaved",function(e){m(),U.chatList.push(e),U.messageLoading=!1})}var U=this;U.currentUser=r.getUser()._id,U.receiverUserID=i.user,U.chatList=[],U.chatRoomId="",U.loadMoreChats=f,U.scrollBottom=m,U.showImageModal=v,U.messageLoading=!1,U.params={page:1,limit:5},function(){c.getChatRoom(U.receiverUserID).then(function(e){console.log(e),U.chatRoom=e.data,U.chatRoomId=e.data._id,b(),g()},function(e){window.alert(JSON.stringify(e))}),h(),w()}(),U.clickSubmit=function(){U.messageLoading=!0,U.focusInput=!0,window.cordova&&!window.cordova.plugins.Keyboard.isVisible&&window.cordova.plugins.Keyboard.show(),m();var e={message:U.myMsg,receiver:i.user,roomId:U.chatRoomId};c.sendChatMessage(e).then(function(e){U.myMsg="",m()}).catch(function(e){window.alert(JSON.stringify(e))})},U.submitUpload=function(){U.messageLoading=!0,U.file.upload=p.upload({url:s.baseURL+"upload/singleUpload",data:{file:U.file}}),U.file.upload.then(function(e){U.file.result=e.data,U.uploadedImage=e.data,U.cancelUpload();var t={message:U.uploadedImage,receiver:i.user,roomId:U.chatRoomId,type:"img"};c.sendChatMessage(t).then(function(e){m()}).catch(function(e){window.alert(e)})})},U.cancelUpload=function(){U.showTempImage=!1,U.tempImageUrl=""},U.uploadSingleImage=function(e,t){U.file=e,U.errFile=t&&t[0],e&&(U.showTempImage=!0,U.tempImageUrl=e,m())},U.leaveChatBox=function(){a.emit("removeFromRoom",{roomId:U.chatRoomId}),c.updateChatRoom(U.chatRoomId).then(function(e){}).catch(function(e){console.log(e),window.alert(JSON.stringify(e))}).finally(function(){}),window.history.back()}}e.module("petal.chat").controller("ChatBoxController",["$scope","$timeout","$ionicModal","Socket","$stateParams","userData","homeService","chatService","$ionicScrollDelegate","userService","Upload","$ionicLoading",t])}(window.angular),function(e){"use strict";function t(){}e.module("petal.chat").controller("ChatParentController",[t])}(window.angular),function(e){"use strict";function t(t,o,n,a){function i(){c.params.page=1,c.chatRoomsList=[],s()}function r(){c.params.page+=1,s()}function s(){n.getRevealedChatRooms(c.params).then(function(t){console.log("Chatrroms"),console.log(t),e.forEach(t.data.docs,function(e){c.chatRoomsList.push(e)})}).finally(function(){a.hide()})}var c=this;c.params={page:1,limit:25},c.chatRoomsList=[],c.getRevealedChatRooms=s,c.loadMoreChats=r,c.pullRefreshChats=i,function(){s()}()}e.module("petal.chat").controller("RevealedChatController",["$scope","$state","chatService","$ionicLoading",t])}(window.angular),function(e){"use strict";function t(e,t,o){function n(t){return console.log("chat messgae"),console.log(t),e.post(o.baseURL+"chat/create/"+t.roomId,t)}function a(t,n){return console.log("params"),console.log(n),e.get(o.baseURL+"chat/getChats/"+t,{params:n})}function i(t){return console.log("get chat room"),console.log(t),e.get(o.baseURL+"chatRoom/get/"+t)}function r(t){return t.revealed=!1,e.get(o.baseURL+"chatRoom/all/",{params:t})}function s(t){return t.revealed=!0,e.get(o.baseURL+"chatRoom/all/",{params:t})}function c(t){return e.post(o.baseURL+"chatRoom/"+t)}var l=this;l.sendChatMessage=n,l.getChatMessages=a,l.getChatRoom=i,l.getAllChatRooms=r,l.getRevealedChatRooms=s,l.updateChatRoom=c}e.module("petal.chat").service("chatService",["$http","$stateParams","homeService",t])}(window.angular),function(e){"use strict";function t(e,t){return e({prefix:"",ioSocket:io.connect(t.baseURL)})}e.module("petal.chat").factory("Socket",["socketFactory","homeService",t])}(window.angular),function(e){"use strict";function t(e,t,o){return e({prefix:"",ioSocket:io.connect(o.baseURL+t.getUser()._id)})}e.module("petal.chat").factory("SocketUserService",["socketFactory","userData","homeService",t])}(window.angular),function(e){"use strict";function t(e,t,o,n,a,i){function r(e){i.show(),t.authenticate(e).then(function(e){n.setUser(e.data.user),a.setUserLocation(),o.go("home.post.nearby")}).catch(function(e){i.hide(),window.alert(e)}).finally(function(){i.hide()})}function s(){t.logout(),n.removeUser(),o.go("authenticate")}var c=this;i.hide(),c.isAuth=t.isAuthenticated(),c.isAuth&&o.go("home.post.all"),c.authLogout=s,c.socialAuthenticate=r}e.module("petal.home").controller("AuthenticationController",["$scope","$auth","$state","userData","userLocationService","$ionicLoading",t])}(window.angular),function(e){"use strict";function t(e,t,o,n,a,i){function r(e){console.log(e),e.user._id==o.getUser()._id||("chatBox"==t.current.name?t.params.user!=e.user._id&&a.info("<p>"+e.user.anonName+"</p><p>"+e.message+"</p>",{allowHtml:!0,onTap:function(){t.go("chatBox",{user:e.user._id})}}):(a.info("<p>"+e.user.anonName+"</p><p>"+e.message+"</p>",{allowHtml:!0,onTap:function(){t.go("chatBox",{user:e.user._id})}}),c.badgeValue=1))}function s(){c.badgeValue=""}var c=this;c.badgeValue="",c.chatClicked=s,n.on("connect",function(){n.emit("addToSingleRoom",{roomId:o.getUser()._id}),n.on("newMessageReceived",r)}),c.goForward=function(){var e=i.selectedIndex();e!=-1&&(1===e?i.select(e+2):i.select(e+1))},c.goBack=function(){var e=i.selectedIndex();e!==-1&&0!==e&&(3===e?i.select(e-2):i.select(e-1))}}e.module("petal.home").controller("HomeController",["$scope","$state","userData","Socket","toastr","$ionicTabsDelegate",t])}(window.angular),function(e){"use strict";e.module("petal.home").directive("distanceView",["postService","$timeout",function(e,t){return{restrict:"E",templateUrl:"app/home/views/distanceViewTemplate.html",scope:{positionCords:"="},replace:!0,link:function(o){function n(){o.positionCords?(o.distanceObj={latitude:o.positionCords[1],longitude:o.positionCords[0]},e.getDistance(o.distanceObj).then(function(e){o.distanceObj.distance=e+" mi"}).catch(function(e){o.distanceObj.distance=""})):(o.distanceObj={},o.distanceObj.distance="")}t(n,1e3)}}}])}(window.angular),function(e){"use strict";e.module("petal.home").directive("keepScroll",["$state","$timeout","ScrollPositions","$ionicScrollDelegate",function(e,t,o,n){return{restrict:"A",link:function(a){a.$on("$stateChangeStart",function(){o[e.current.name]=n.getScrollPosition()}),t(function(){var t;(t=o[e.current.name])&&n.scrollTo(t.left,t.top)})}}}]).factory("ScrollPositions",[function(){return{}}]).directive("isFocused",["$timeout",function(e){return{scope:{trigger:"@isFocused"},link:function(t,o){t.$watch("trigger",function(t){"true"===t&&e(function(){o[0].focus(),o.on("blur",function(){o[0].focus()})})})}}}]).directive("lazyImg",function(){return{replace:!0,template:'<div class="lazy-img"><div class="sm"><img src="{{imgSmall}}" class="small"/></div><div style="padding-bottom: 75%;"></div><img src="{{imgLarge}}" class="large"/></div>',scope:{imgLarge:"@srcLarge",imgSmall:"@srcSmall"},link:function(e,t){var o=new Image,n=new Image;o.src=e.imgSmall,o.onload=function(){t.children(".sm").find("img").css("opacity","1"),n.src=e.imgLarge,n.onload=function(){t.find("img").css("opacity","1")}}}}})}(window.angular),function(e){"use strict";function t(e,t){function o(t){return e.post(a.baseURL+"upload/deleteUpload",{data:{public_id:t}})}function n(e){return t.upload({url:a.baseURL+"upload/singleUploadId",data:{file:e}})}this.baseURL="https://banana-surprise-31332.herokuapp.com/",this.deleteUpload=o,this.submitUpload=n;var a=this}e.module("petal.home").service("homeService",["$http","Upload",t])}(window.angular),function(e){"use strict";function t(e,t,o,n){function a(e){var a=o.defer();return n.show(),t.post(i+"notification/register",{device_token:e}).then(function(e){a.resolve(e)}).catch(function(e){a.reject(e)}).finally(function(){n.hide()}),a.promise}var i=e.baseURL;return{register:a}}e.module("petal.home").service("RequestsService",["homeService","$http","$q","$ionicLoading",t])}(window.angular),function(e){"use strict";function t(e,t,o,n,a){var i=e.localStorage,r={},s={setUser:function(e){if(e)i.setItem("user",JSON.stringify(e));else{var t=o.getPayload().sub;if(t)return n.get(a.baseURL+"user/get/"+t).then(function(e){console.log("response"),console.log(e),i.setItem("user",JSON.stringify(e.data))})}},getUser:function(){return JSON.parse(i.getItem("user"))},removeUser:function(){r=null,i.removeItem("user")},isUserExists:function(){return!!s.getUser()}};return s}e.module("petal.home").factory("userData",["$window","$state","$auth","$http","homeService",t])}(window.angular),function(e){"use strict";function t(t,o,n,a){function i(){u()}function r(){p.peopleSearchText="",p.showSearchCross=!1,u()}function s(e){p.showSearchCross=!0,e&&(p.peopleSearchText=e),u()}function c(){p.params.page+=1,l()}function l(){n.getAllUsers(p.params).then(function(t){console.log(t),e.forEach(t.data.docs,function(e){p.peopleList.push(e)}),p.initialSearchCompleted=!0,t.data.total>p.peopleList.length&&(p.canLoadMoreResults=!0)}).catch(function(e){console.log(e)}).finally(function(){t.$broadcast("scroll.refreshComplete"),t.$broadcast("scroll.infiniteScrollComplete"),a.hide()})}function u(){p.canLoadMoreResults=!1,p.initialSearchCompleted=!1,p.peopleList=[],p.params={limit:25,page:1},p.peopleSearchText&&(p.params.interest=p.peopleSearchText),l()}var p=this;p.getAllPeople=l,p.pullRefreshPeople=i,p.loadMorePeople=c,p.searchCrossSubmit=r,p.peopleSearchTextSubmit=s,u()}e.module("petal.people").controller("AllPeopleController",["$scope","$state","peopleService","$ionicLoading",t])}(window.angular),function(e){"use strict";function t(t,o,n,a){function i(){l()}function r(){u.params.page+=1,c()}function s(){l()}function c(){n.getNearbyUsers(u.params).then(function(o){e.forEach(o.data.docs,function(e){u.peopleList.push(e)}),u.initialSearchCompleted=!0,o.data.total>u.peopleList.length&&(u.canLoadMoreResults=!0),t.$broadcast("scroll.infiniteScrollComplete")}).catch(function(e){console.log(e),3==e.code?window.alert("Unable to access your location.Make sure location is turned on."):2!=e.code&&1!=e.code||window.alert("Please enable location or gps")}).finally(function(){t.$broadcast("scroll.refreshComplete"),t.$broadcast("scroll.infiniteScrollComplete"),a.hide()})}function l(){u.canLoadMoreResults=!1,u.initialSearchCompleted=!1,u.peopleList=[],u.params={limit:25,page:1,distance:u.distance},c()}var u=this;u.getNearbyPeople=c,u.pullRefreshPeople=i,u.loadMorePeople=r,u.releaseRange=s,u.distance=10,l()}e.module("petal.people").controller("NearbyPeopleController",["$scope","$state","peopleService","$ionicLoading",t])}(window.angular),function(e){"use strict";function t(){}e.module("petal.people").controller("PeopleParentController",[t])}(window.angular),function(e){"use strict";function t(t,o,n,a){function i(){c()}function r(){l.params.page+=1,s()}function s(){n.getReceivedUsers(l.params).then(function(t){console.log("response"),console.log(t),e.forEach(t.data.docs,function(e){l.peopleList.push(e)}),console.log(l.peopleList),l.initialSearchCompleted=!0,t.data.total>l.peopleList.length&&(l.canLoadMoreResults=!0)}).catch(function(e){console.log(e)}).finally(function(){t.$broadcast("scroll.refreshComplete"),t.$broadcast("scroll.infiniteScrollComplete"),a.hide()})}function c(){l.canLoadMoreResults=!1,l.initialSearchCompleted=!1,l.peopleList=[],l.params={limit:10,page:1},s()}var l=this;l.getReceivedPeople=s,l.pullRefreshPeople=i,l.loadMorePeople=r,c()}e.module("petal.people").controller("ReceivedPeopleController",["$scope","$state","peopleService","$ionicLoading",t])}(window.angular),function(e){"use strict";function t(t,o,n,a){function i(){c()}function r(){l.params.page+=1,s()}function s(){n.getRequestedUsers(l.params).then(function(t){console.log(t),e.forEach(t.data.docs,function(e){l.peopleList.push(e)}),l.initialSearchCompleted=!0,t.data.total>l.peopleList.length&&(l.canLoadMoreResults=!0)}).catch(function(e){console.log(e)}).finally(function(){t.$broadcast("scroll.refreshComplete"),t.$broadcast("scroll.infiniteScrollComplete"),a.hide()})}function c(){l.canLoadMoreResults=!1,l.initialSearchCompleted=!1,l.peopleList=[],l.params={limit:25,page:1},s()}var l=this;l.getRequestedPeople=s,l.pullRefreshPeople=i,l.loadMorePeople=r,c()}e.module("petal.people").controller("RequestedPeopleController",["$scope","$state","peopleService","$ionicLoading",t])}(window.angular),function(e){"use strict";function t(t,o,n,a){function i(){c()}function r(){l.params.page+=1,s()}function s(){n.getRevealedUsers(l.params).then(function(t){console.log("response"),console.log(t),e.forEach(t.data.docs,function(e){l.peopleList.push(e)}),l.initialSearchCompleted=!0,t.data.total>l.peopleList.length&&(l.canLoadMoreResults=!0)}).catch(function(e){console.log(e)}).finally(function(){t.$broadcast("scroll.refreshComplete"),t.$broadcast("scroll.infiniteScrollComplete"),a.hide()})}function c(){l.canLoadMoreResults=!1,l.initialSearchCompleted=!1,l.peopleList=[],l.params={limit:25,page:1},s()}var l=this;l.getRevealedPeople=s,l.pullRefreshPeople=i,l.loadMorePeople=r,c()}e.module("petal.people").controller("RevealedPeopleController",["$scope","$state","peopleService","$ionicLoading",t])}(window.angular),function(e){"use strict";function t(e){return{restrict:"E",templateUrl:"app/people/views/peopleListTemplate.html",scope:{listType:"@listType",peopleList:"=peopleList",peopleSearchTextSubmit:"&peopleSearchTextSubmit"},controller:["$scope",function(t){t.currentUser=e.getUser(),t.setPeopleSearch=function(e,o){t.peopleSearchTextSubmit&&(t.peopleSearchTextSubmit({interest:e}),o.stopPropagation())},t.removeAfterDecided=function(e){t.peopleList.splice(e,1)}}]}}e.module("petal.people").directive("peopleList",["userData",t])}(window.angular),function(e){"use strict";function t(e){return{scope:{chatPage:"@"},link:function(t,o){o.bind("click",function(o){e.go("chatBox",{user:t.chatPage}),o.stopPropagation()})}}}function o(e){return{scope:{userPage:"@"},link:function(t,o){o.bind("click",function(o){e.go("home.userPage",{user:t.userPage}),o.stopPropagation()})}}}function n(e,t){return{restrict:"A",scope:{afterCallback:"&",cancelReveal:"@"},link:function(o,n){n.bind("click",function(n){e.show({titleText:"Reveal",buttons:[{text:'<i class="icon ion-share"></i> Cancel Reveal Request'}],cancelText:"Cancel",cancel:function(){console.log("CANCELLD")},buttonClicked:function(e){return t.cancel(o.cancelReveal).then(function(e){o.afterCallback&&o.afterCallback()}).catch(function(e){window.alert(JSON.stringify(e))}),!0}}),n.stopPropagation()})}}}function a(e,t){return{restrict:"A",scope:{afterCallback:"&",decideReveal:"@"},link:function(o,n){n.bind("click",function(n){e.show({titleText:"Reveal",buttons:[{text:'<i class="icon ion-share"></i> Accept Reveal Request'},{text:'<i class="icon ion-share"></i> Deny Reveal Request'}],cancelText:"Cancel",cancel:function(){console.log("CANCELLED")},buttonClicked:function(e){return 0===e?t.accept(o.decideReveal).then(function(e){o.afterCallback&&o.afterCallback()}).catch(function(e){window.alert(JSON.stringify(e))}):1===e&&t.ignore(o.decideReveal).then(function(e){o.afterCallback&&o.afterCallback()}).catch(function(e){window.alert(JSON.stringify(e))}),!0}}),n.stopPropagation()})}}}function i(e,t){return{restrict:"A",scope:{afterCallback:"&",deleteReveal:"@"},link:function(o,n){n.bind("click",function(n){e.show({titleText:"Reveal",buttons:[{text:'<i class="icon ion-share"></i> Delete Reveal '}],cancelText:"Cancel",cancel:function(){console.log("CANCELLED")},buttonClicked:function(e){return 0===e&&t.finish(o.deleteReveal).then(function(e){o.afterCallback&&o.afterCallback()}).catch(function(e){window.alert(JSON.stringify(e))}),!0}}),n.stopPropagation()})}}}function r(e,t){return{restrict:"A",scope:{afterCallback:"&",sendReveal:"@"},link:function(o,n){n.bind("click",function(n){e.show({titleText:"Reveal",buttons:[{text:'<i class="icon ion-share"></i> Send Reveal Request'}],cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){return t.initiate(o.sendReveal).then(function(e){o.afterCallback&&o.afterCallback()}).catch(function(e){window.alert(JSON.stringify(e))}),!0}}),n.stopPropagation()})}}}e.module("petal.people").directive("cancelReveal",["$ionicActionSheet","revealService",n]).directive("decideReveal",["$ionicActionSheet","revealService",a]).directive("deleteReveal",["$ionicActionSheet","revealService",i]).directive("sendReveal",["$ionicActionSheet","revealService",r]).directive("chatPage",["$state",t]).directive("userPage",["$state",o])}(window.angular),function(e){"use strict";function t(e,t,o,n){function a(o){return o.all=!0,e.get(t.baseURL+"user/getUsers",{params:o})}function i(o){return o.revealed=!0,e.get(t.baseURL+"user/getUsers",{params:o})}function r(o){return o.received=!0,e.get(t.baseURL+"user/getUsers",{params:o})}function s(o){return o.requested=!0,e.get(t.baseURL+"user/getUsers",{params:o})}function c(a){0===a.page&&o.setUserLocation(),a.nearby=!0;var i=n.defer();return o.getUserLocation().then(function(o){a.latitude=o.latitude,a.longitude=o.longitude,e.get(t.baseURL+"user/getUsers",{params:a}).then(function(e){i.resolve(e)}).catch(function(e){i.reject(e)})}).catch(function(e){i.reject(e)}),i.promise}this.getAllUsers=a,this.getRevealedUsers=i,this.getNearbyUsers=c,this.getRequestedUsers=s,this.getReceivedUsers=r,this.getNearbyUsers=c}e.module("petal.people").service("peopleService",["$http","homeService","userLocationService","$q",t])}(window.angular),function(e){"use strict";function t(e,t){function o(o){return e.get(t.baseURL+"upvote/get/"+o)}function n(o){return e.post(t.baseURL+"upvote/create/"+o)}function a(o){return e.post(t.baseURL+"upvote/delete/"+o)}this.createUpvote=n,this.deleteUpvote=a,this.getUpvote=o}e.module("petal.post").service("upvoteService",["$http","homeService",t])}(window.angular),function(e){"use strict";function t(t,o,n,a){function i(){u()}function r(){p.postSearchText="",p.showSearchCross=!1,u()}function s(e){p.showSearchCross=!0,e&&(p.postSearchText=e),p.postSearchText&&u()}function c(){p.params.page+=1,l()}function l(){p.noPosts=!1,n.getAllPosts(p.params).then(function(t){t.data.total?p.noPosts=!1:p.noPosts=!0,e.forEach(t.data.docs,function(e){p.postsList.push(e)}),p.initialSearchCompleted=!0,t.data.total>p.postsList.length?p.canLoadMoreResults=!0:p.canLoadMoreResults=!1}).catch(function(e){window.alert(JSON.stringify(e))}).finally(function(){t.$broadcast("scroll.refreshComplete"),t.$broadcast("scroll.infiniteScrollComplete"),a.hide()})}function u(){p.canLoadMoreResults=!1,p.initialSearchCompleted=!1,p.postsList=[],p.params={limit:3,page:1},p.postSearchText&&(p.params.interest=p.postSearchText),l()}var p=this;p.getAllPosts=l,p.pullRefreshPosts=i,p.loadMorePosts=c,p.postSearchTextSubmit=s,p.searchCrossSubmit=r,p.params={limit:3,page:1},u()}e.module("petal.post").controller("AllPostController",["$scope","$state","postService","$ionicLoading",t])}(window.angular),function(e){"use strict";function t(e,t,o,n,a){function i(){n.show(),o.submitPost(r.post).then(function(e){t.go("home.post.latest")}).catch(function(e){console.log("post error"),window.alert(JSON.stringify(e))})}var r=this;r.submitPost=i,r.post={},n.hide(),r.goBack=function(){window.history.back()},e.$watch(function(){return r.post.content},function(e,t){e&&e.length>300&&(r.post.content=t)}),r.cancelUpload=function(){r.post.imageId&&a.deleteUpload(r.post.imageId).then(function(e){r.post.image="",r.post.imageId="",console.log(r.post)})},r.submitUpload=function(e,t){r.post.imageId&&r.cancelUpload(),r.loadingImage=!0,r.file=e,r.errFile=t&&t[0],r.file&&a.submitUpload(r.file).then(function(e){console.log("uploaded fi"),console.log(e),r.post.image=e.data.image,r.post.imageId=e.data.imageId,r.loadingImage=!1})}}e.module("petal.post").controller("CreatePostController",["$scope","$state","postService","$ionicLoading","homeService",t])}(window.angular),function(e){"use strict";function t(t,o,n,a){function i(){c()}function r(){l.params.page+=1,s()}function s(){n.getLatestPosts(l.params).then(function(t){e.forEach(t.data.docs,function(e){l.postsList.push(e)}),l.initialSearchCompleted=!0,t.data.total>l.postsList.length?l.canLoadMoreResults=!0:l.canLoadMoreResults=!1}).catch(function(e){console.log(e)}).finally(function(){t.$broadcast("scroll.refreshComplete"),t.$broadcast("scroll.infiniteScrollComplete"),a.hide()})}function c(){l.canLoadMoreResults=!1,l.initialSearchCompleted=!1,l.postsList=[],l.params={limit:3,page:1},s()}var l=this;l.getLatestPosts=s,l.pullRefreshPosts=i,l.loadMorePosts=r,c()}e.module("petal.post").controller("LatestPostController",["$scope","$state","postService","$ionicLoading",t])}(window.angular),function(e){"use strict";function t(t,o,n,a){function i(){l()}function r(){l()}function s(){u.params.page+=1,c()}function c(){n.getNearbyPosts(u.params).then(function(o){e.forEach(o.data.docs,function(e){u.postsList.push(e)}),u.initialSearchCompleted=!0,o.data.total>u.postsList.length?u.canLoadMoreResults=!0:u.canLoadMoreResults=!1,t.$broadcast("scroll.infiniteScrollComplete")}).catch(function(e){console.log(e),3==e.code?window.alert("Unable to acces your location"):2!=e.code&&1!=e.code||window.alert("Please enable location or gps")}).finally(function(){t.$broadcast("scroll.refreshComplete"),t.$broadcast("scroll.infiniteScrollComplete"),a.hide()})}function l(){u.canLoadMoreResults=!1,u.initialSearchCompleted=!1,u.postsList=[],u.params={limit:10,page:1,distance:u.distance},c()}var u=this;u.getNearbyPosts=c,u.pullRefreshPosts=i,u.loadMorePosts=s,u.releaseRange=r,u.distance=10,l()}e.module("petal.post").controller("NearbyPostController",["$scope","$state","postService","$ionicLoading",t])}(window.angular),function(e){"use strict";function t(t,o,n,a){function i(){c()}function r(){l.params.page+=1,s()}function s(){n.getPopularPosts(l.params).then(function(t){e.forEach(t.data.docs,function(e){l.postsList.push(e)}),l.initialSearchCompleted=!0,t.data.total>l.postsList.length?l.canLoadMoreResults=!0:l.canLoadMoreResults=!1}).catch(function(e){console.log(e)}).finally(function(){t.$broadcast("scroll.refreshComplete"),t.$broadcast("scroll.infiniteScrollComplete"),a.hide()})}function c(){l.canLoadMoreResults=!1,l.initialSearchCompleted=!1,l.postsList=[],l.params={limit:3,page:1},s()}var l=this;l.getPopularPosts=s,l.pullRefreshPosts=i,l.loadMorePosts=r,c()}e.module("petal.post").controller("PopularPostController",["$scope","$state","postService","$ionicLoading",t])}(window.angular),function(e){"use strict";function t(){}e.module("petal.post").controller("PostParentController",[t])}(window.angular),function(e){"use strict";function t(e,t,o,n,a,i){function r(){o.getPost(n.id).then(function(e){p.post=e.data,p.distanceObj={latitude:p.post.loc[1],longitude:p.post.loc[0],diatance:0},u()})}function s(){i.getUpvote(p.currentPost).then(function(e){p.postUpvoted=e.data||!1}).catch(function(e){console.log(e)})}function c(){i.createUpvote(p.currentPost).then(function(e){s()}).catch(function(e){console.log(e)})}function l(){i.deleteUpvote(p.currentPost).then(function(e){s()}).catch(function(e){console.log(e)})}function u(){o.getDistance(p.distanceObj)}var p=this;p.getSinglePost=r,p.submitPostUpvote=c,p.deletePostUpvote=l,p.getPostDistance=u,p.back=function(){window.history.back()},function(){p.currentPost=n.id,r(),s()}()}e.module("petal.post").controller("SinglePostController",["$scope","$state","postService","$stateParams","$ionicHistory","upvoteService",t])}(window.angular),function(e){"use strict";function t(e,t,o,n,a){return{restrict:"E",templateUrl:"app/post/views/postsListTemplate.html",scope:{postsList:"=postsList",postSearchTextSubmit:"&postSearchTextSubmit"},replace:!0,link:function(o){function n(t){o.modal.hide(),e.go("home.user.userPage",{user:t})}function i(){return a.fromTemplateUrl("app/post/views/postModal.html",{scope:o}).then(function(e){o.modal=e})}o.getTime=function(e){return moment(e).fromNow(!0)},o.currentUser=t.getUser(),o.setPostSearch=function(e){o.postSearchTextSubmit&&o.postSearchTextSubmit({interest:e})},o.userPage=n,o.postModal={},o.postModal.userPage=n,o.showPostModal=function(e){o.postModal.post=e,i().then(function(){o.modal.show()}),o.$on("modal.hidden",function(){o.modal.remove()})}}}}e.module("petal.post").directive("postsList",["$state","userData","postService","upvoteService","$ionicModal",t])}(window.angular),function(e){"use strict";function t(e,t,o){return{restrict:"E",templateUrl:"app/post/views/postUpvoteTemplate.html",scope:{postId:"=postId",upvotesLength:"=upvotesLength"},replace:!0,
link:function(e){function o(){t.getUpvote(e.postId).then(function(t){e.postUpvoted=t.data,e.loadingUpvote=!1}).catch(function(e){console.log("check error"),console.log(e)})}function n(){e.postUpvoted=!0,t.createUpvote(e.postId).then(function(){e.upvotesLength+=1}).catch(function(e){console.log("submit error"),console.log(e)})}function a(){e.postUpvoted=!1,t.deleteUpvote(e.postId).then(function(){e.upvotesLength-=1}).catch(function(e){window.alert(e)})}e.checkPostUpvote=o,e.submitPostUpvote=n,e.deletePostUpvote=a,function(){e.loadingUpvote=!0,o()}()}}}e.module("petal.post").directive("postUpvote",["$state","upvoteService","$timeout",t])}(window.angular),function(e){"use strict";function t(e,t,o,n){function a(o){return e.get(t.baseURL+"post/getPosts",{params:o})}function i(a){a.nearby=!0;var i=n.defer();return 0===a.page&&o.setUserLocation(),o.getUserLocation().then(function(o){a.latitude=o.latitude,a.longitude=o.longitude,e.get(t.baseURL+"post/getPosts",{params:a}).then(function(e){i.resolve(e)}).catch(function(e){i.reject(e)})}).catch(function(e){i.reject(e)}),i.promise}function r(o){return o.sort="-time",e.get(t.baseURL+"post/getPosts",{params:o})}function s(o){return o.sort="-upvotesLength",e.get(t.baseURL+"post/getPosts",{params:o})}function c(a){var i=n.defer();return o.getUserLocation().then(function(o){a.latitude=o.latitude,a.longitude=o.longitude,e.post(t.baseURL+"post/create",{post:a}).then(function(e){i.resolve(e)}).catch(function(e){i.reject(e)})}).catch(function(o){alert("errr"),window.alert(JSON.stringify(o)),e.post(t.baseURL+"post/create",{post:a}).then(function(e){console.log("inside service catch"),console.log(e),i.resolve(e)}).catch(function(e){i.reject(e)})}),i.promise}function l(o){return e.delete(t.baseURL+"post/delete/"+o)}function u(o){return e.get(t.baseURL+"post/get/"+o)}function p(e){var t=e.latitude,n=e.longitude;return o.getUserLocation().then(function(e){var o=e.latitude,a=e.longitude,i=d(o-t),r=d(a-n),s=Math.sin(i/2)*Math.sin(i/2)+Math.cos(d(t))*Math.cos(d(o))*Math.sin(r/2)*Math.sin(r/2),c=2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s)),l=6371*c;return Math.ceil(l)}).catch(function(e){console.log(e)})}function d(e){return e*(Math.PI/180)}this.getAllPosts=a,this.getNearbyPosts=i,this.getLatestPosts=r,this.getPopularPosts=s,this.submitPost=c,this.deletePost=l,this.getPost=u,this.getDistance=p}e.module("petal.post").service("postService",["$http","homeService","userLocationService","$q",t])}(window.angular),function(e){"use strict";function t(e,t,o,n,a,i,r){function s(){l.user=n.getUser(),e.editForm.user=l.user,l.user.interests.length&&(e.editForm.user.interests="!"+l.user.interests.join("!"))}function c(){e.editForm={},s()}var l=this;l.activate=c,c(),e.editForm.submitUser=function(){r.show(),console.log(e.editForm.user),a.updateUser(e.editForm.user).then(function(e){window.alert("updated user"),console.log(e)}).catch(function(e){window.alert(e)}).finally(function(){n.setUser(),r.hide()})},e.editForm.uploadUserPicture=function(t,n){e.loadingImage=!0,l.file=t,l.errFile=n&&n[0],t&&(l.file.upload=i.upload({url:o.baseURL+"upload/singleUpload",data:{file:l.file}}),l.file.upload.then(function(t){l.file.result=t.data,e.editForm.user.picture=t.data,e.loadingImage=!1}))}}e.module("petal.user").controller("UserEditPageController",["$scope","$state","homeService","userData","userService","Upload","$ionicLoading",t])}(window.angular),function(e){"use strict";function t(e,t,o,n,a,i,r,s,c,l,u,p){function d(e){u.open("https://www.facebook.com/"+e,"_system")}function f(){a.setUser().then(function(){P.user=a.getUser(),e.editForm.user=P.user,P.user.interests.length&&(e.editForm.user.interests="!"+P.user.interests.join("!"))}).catch(function(e){window.alert(e)}).finally(function(){p.hide()})}function h(){P.params={page:1,limit:100,user:a.getUser()._id},l.getAllPosts(P.params).then(function(e){P.postsList=e.data.docs})}function m(e){P.activeTab=e}function g(e){return e===P.activeTab}function v(){i.fromTemplateUrl("app/user/views/userEditForm.html",{scope:e}).then(function(t){e.editForm.modal=t})}function w(){o.logout(),t.go("authenticate")}function b(){f(),e.editForm={},v(),U(),e.$broadcast("scroll.refreshComplete"),h()}function U(){s.getRequestedUsers({page:1,limit:25}).then(function(e){P.peopleList=e.data.docs,P.total=e.data.total})}var P=this;P.logout=w,P.activate=b,P.activeTab=1,P.activateTab=m,P.isTabActive=g,P.openFacebook=d,b(),e.editForm.submitUser=function(){r.updateUser(e.editForm.user).then(function(){window.alert("updated user"),e.editForm.modal.hide()})},e.editForm.uploadUserPicture=function(t,o){e.loadingImage=!0,P.file=t,P.errFile=o&&o[0],t&&(P.file.upload=c.upload({url:n.baseURL+"upload/singleUpload",data:{file:P.file}}),P.file.upload.then(function(t){P.file.result=t.data,e.editForm.user.picture=t.data,e.loadingImage=!1}))}}e.module("petal.user").controller("UserMePageController",["$scope","$state","$auth","homeService","userData","$ionicModal","userService","peopleService","Upload","postService","$window","$ionicLoading",t])}(window.angular),function(e){"use strict";function t(e,t,o,n,a,i,r,s,c){function l(e){s.open("https://www.facebook.com/"+e,"_system")}function u(){g.params={page:1,limit:100,user:a.user},r.getLatestPosts(g.params).then(function(e){g.postsList=e.data.docs})}function p(e){g.activeTab=e}function d(e){return e===g.activeTab}function f(){n.check(a.user).then(function(e){g.revealChoice=e.data})}function h(){window.history.back()}function m(){o.getUser(a.user).then(function(e){g.user=e.data}).finally(function(){c.hide()})}var g=this;g.checkReveal=f,g.goBack=h,g.activateTab=p,g.isTabActive=d,g.openFacebook=l,function(){m(),g.revealChoice=i,g.activeTab=1,u()}()}e.module("petal.user").controller("UserPageController",["$state","$auth","userService","revealService","$stateParams","friends","postService","$window","$ionicLoading",t])}(window.angular),function(e){"use strict";function t(e,t,o){alert(o)}e.module("petal.user").controller("UserPagePostsController",["$state","$stateParams","friends",t])}(window.angular),function(e){"use strict";function t(){}e.module("petal.user").controller("UserParentController",[t])}(window.angular),function(e){"use strict";function t(e,t){function o(e){return{secondUser:e}}function n(o){return e.post(t.baseURL+"reveal/initiate",{secondUser:o})}function a(o){return e.post(t.baseURL+"reveal/accept",{secondUser:o})}function i(o){return e.post(t.baseURL+"reveal/ignore",{secondUser:o})}function r(o){return e.post(t.baseURL+"reveal/cancel",{secondUser:o})}function s(n){var a=o(n);return e.get(t.baseURL+"reveal/received",{params:a})}function c(n){var a=o(n);return e.get(t.baseURL+"reveal/requested",{params:a})}function l(n){var a=o(n);return e.get(t.baseURL+"reveal/revealed",{params:a})}function u(o){return e.post(t.baseURL+"reveal/finish",{secondUser:o})}function p(n){var a=o(n);return e.get(t.baseURL+"reveal/check",{params:a})}this.initiate=n,this.accept=a,this.ignore=i,this.cancel=r,this.received=s,this.requested=c,this.revealed=l,this.finish=u,this.check=p}e.module("petal.user").service("revealService",["$http","homeService",t])}(window.angular),function(e){"use strict";function t(e,t){function o(){var t={timeout:1e4,enableHighAccuracy:!0};return e.getCurrentPosition(t).then(function(e){return{latitude:e.coords.latitude,longitude:e.coords.longitude}})}function n(){var o={timeout:1e4,enableHighAccuracy:!0};e.getCurrentPosition(o).then(function(e){var o={latitude:e.coords.latitude,longitude:e.coords.longitude};t.updateUser(o)})}this.getUserLocation=o,this.setUserLocation=n}e.module("petal.user").service("userLocationService",["$cordovaGeolocation","userService",t])}(window.angular),function(e){"use strict";function t(e,t){function o(o){return e.get(t.baseURL+"user/get/"+o)}function n(o){return e.post(t.baseURL+"user/update/",{user:o})}this.updateUser=n,this.getUser=o}e.module("petal.user").service("userService",["$http","homeService",t])}(window.angular);