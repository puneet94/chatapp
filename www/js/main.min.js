!function(e){"use strict";var t=e.module("petal",["ui.router","ionic","ionic-material","satellizer","ngFileUpload","btford.socket-io","ngCordova","toastr","petal.home","petal.post","petal.chat","petal.user","petal.people"]);t.config(["$urlRouterProvider","$stateProvider","$ionicConfigProvider",function(e,t,o){o.tabs.position("bottom"),e.otherwise("/home/post/all")}]),t.run(["$rootScope","$state","$ionicPlatform",function(e,t,o){o.ready(function(){window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault()})}])}(window.angular),function(e){"use strict";function t(e){e.state("home.chat",{url:"/chat",abstract:!0,views:{"chat-tab":{templateUrl:"app/chat/views/chatParent.html",controller:"ChatParentController",controllerAs:"ppc"}}}).state("home.chat.all",{url:"/all",views:{"chat-tab":{templateUrl:"app/chat/views/allChat.html",controller:"AllChatController",controllerAs:"acc"}}}).state("home.chat.revealed",{url:"/revealed",views:{"chat-tab":{templateUrl:"app/chat/views/revealedChat.html",controller:"RevealedChatController",controllerAs:"rpc"}}}).state("chatBox",{url:"/chatBox/:user",templateUrl:"app/chat/views/chatBox.html",controller:"ChatBoxController",controllerAs:"cbc"})}e.module("petal.chat",["ngFileUpload"]).config(["$stateProvider",t])}(window.angular),function(e){"use strict";function t(e,t){var n="https://petalchat-imanjithreddy.c9users.io/authenticate";t.facebook({clientId:"1134208830041632",url:n+"/auth/facebook",redirectUri:"https://petalchat-imanjithreddy.c9users.io/"}),t.google({clientId:"742676837265-33jntkd60p87gkrh48nqe6cdd8ntsfl5.apps.googleusercontent.com",url:n+"/auth/google",redirectUri:"http://localhost:8100"}),e.state("authenticate",{url:"/authenticate",controller:"AuthenticationController",controllerAs:"ac",templateUrl:"app/home/views/authenticationPage.html"}).state("home",{url:"/home",abstract:!0,templateUrl:"app/home/views/tabs.html",controller:"HomeController",controllerAs:"hc",resolve:{redirectIfUserNotAuthenticated:["$q","$auth","$state","$timeout",o]}})}function o(e,t,o,n){var a=e.defer();return t.isAuthenticated()?a.resolve():(console.log("not audsnf"),n(function(){o.go("authenticate")})),a.promise}e.module("petal.home",[]).config(["$stateProvider","$authProvider",t])}(window.angular),function(e){"use strict";function t(e){e.state("home.people",{url:"/people",abstract:!0,views:{"people-tab":{templateUrl:"app/people/views/peopleParent.html",controller:"PeopleParentController",controllerAs:"ppc"}}}).state("home.people.all",{url:"/all",views:{"people-tab":{templateUrl:"app/people/views/allPeople.html",controller:"AllPeopleController",controllerAs:"apc"}}}).state("home.people.revealed",{url:"/revealed",views:{"people-tab":{templateUrl:"app/people/views/revealedPeople.html",controller:"RevealedPeopleController",controllerAs:"rpc"}}}).state("home.people.received",{url:"/received",views:{"people-tab":{templateUrl:"app/people/views/receivedPeople.html",controller:"ReceivedPeopleController",controllerAs:"rpc"}}}).state("home.people.nearby",{url:"/nearby",views:{"people-tab":{templateUrl:"app/people/views/nearbyPeople.html",controller:"NearbyPeopleController",controllerAs:"npc"}}})}e.module("petal.people",[]).config(["$stateProvider",t])}(window.angular),function(e){"use strict";function t(e){e.state("home.post",{url:"/post",abstract:!0,views:{"post-tab":{templateUrl:"app/post/views/postParent.html",controller:"PostParentController",controllerAs:"ppc"}}}).state("home.post.all",{url:"/all",views:{"post-tab":{templateUrl:"app/post/views/allPost.html",controller:"AllPostController",controllerAs:"apc"}}}).state("home.post.latest",{url:"/latest",views:{"post-tab":{templateUrl:"app/post/views/latestPost.html",controller:"LatestPostController",controllerAs:"lpc"}}}).state("home.post.popular",{url:"/popular",views:{"post-tab":{templateUrl:"app/post/views/popularPost.html",controller:"PopularPostController",controllerAs:"ppc"}}}).state("home.post.nearby",{url:"/nearby",views:{"post-tab":{templateUrl:"app/post/views/nearbyPost.html",controller:"NearbyPostController",controllerAs:"npc"}}}).state("home.postSubmit",{url:"/submit",views:{"postSubmit-tab":{templateUrl:"app/post/views/createPost.html",controller:"CreatePostController",controllerAs:"cpc"}}}).state("singlePost",{url:"/post/:id",templateUrl:"app/post/views/singlePost.html",controller:"SinglePostController",controllerAs:"spc"})}e.module("petal.post",[]).config(["$stateProvider",t])}(window.angular),function(e){"use strict";function t(e,t){return t.check(e.user).then(function(e){return e.data})}e.module("petal.user",[]).config(["$stateProvider",function(e){e.state("home.user",{url:"/user",abstract:!0,views:{"user-tab":{templateUrl:"app/user/views/userParentPage.html",controller:"UserParentController",controllerAs:"upc"}}}).state("home.user.userPage",{url:"/userPage/:user",resolve:{friends:["$stateParams","revealService",t]},views:{"user-tab":{templateUrl:"app/user/views/userProfilePage.html",controller:"UserPageController",controllerAs:"upc"}}}).state("home.user.userPage.posts",{url:"/posts",views:{"user-posts":{templateUrl:"app/user/views/userProfilePagePosts.html",controller:"UserPagePostsController",controllerAs:"uppc"}}}).state("home.user.userMePage",{url:"/userMePage",views:{"user-tab":{templateUrl:"app/user/views/userMePage.html",controller:"UserMePageController",controllerAs:"umpc"}}})}])}(window.angular),function(e){"use strict";function t(t,o,n){function a(){l.params.page=1,l.chatRoomsList=[],r()}function s(){l.params.page+=1,r()}function r(){n.getAllChatRooms(l.params).then(function(t){console.log("all chats"),e.forEach(t.data.docs,function(e){l.chatRoomsList.push(e)}),console.log(l.chatRoomsList)})}var l=this;l.params={page:1,limit:25},l.chatRoomsList=[],l.getAllChatRooms=r,l.loadMoreChats=s,l.pullRefreshChats=a,function(){r()}()}e.module("petal.chat").controller("AllChatController",["$scope","$state","chatService",t])}(window.angular),function(e){"use strict";function t(t,o,n,a,s,r,l,i,c,u,p,d){function h(){b.params.page+=1,g()}function f(){u.getUser(b.receiverUserID).then(function(e){b.receiverUser=e.data}).catch(function(e){window.alert(e),console.log(e)})}function m(){b.messageLoading=!1,o(function(){c.scrollBottom(!0)})}function g(){i.getChatMessages(b.chatRoomId,b.params).then(function(t){e.forEach(t.data.docs,function(e){b.chatList.unshift(e)})}).catch(function(e){window.alert(JSON.stringify(e)),console.log(e)}).finally(function(){m(),t.$broadcast("scroll.refreshComplete")})}function v(e){t.currentImage=e,t.modal.show()}function w(){n.fromTemplateUrl("app/chat/views/chatImageModal.html",{scope:t}).then(function(e){t.modal=e})}function P(){a.emit("addToChatRoom",{roomId:b.chatRoomId}),a.on("messageReceived",function(e){m(),b.chatList.push(e)}),a.on("messageSaved",function(e){m(),b.chatList.push(e)})}var b=this;b.currentUser=r.getUser()._id,b.receiverUserID=s.user,b.chatList=[],b.chatRoomId="",b.loadMoreChats=h,b.scrollBottom=m,b.showImageModal=v,b.messageLoading=!1,b.params={page:1,limit:5},function(){i.getChatRoom(b.receiverUserID).then(function(e){console.log(e),b.chatRoom=e.data,b.chatRoomId=e.data._id,P(),g()},function(e){window.alert(JSON.stringify(e))}),f(),w()}(),b.clickSubmit=function(){b.focusInput=!0,b.messageLoading=!0;var e={message:b.myMsg,receiver:s.user,roomId:b.chatRoomId};i.sendChatMessage(e).then(function(e){b.myMsg="",m()}).catch(function(e){window.alert(JSON.stringify(e))})},b.submitUpload=function(){b.file.upload=p.upload({url:l.baseURL+"upload/singleUpload",data:{file:b.file}}),b.file.upload.then(function(e){b.file.result=e.data,b.uploadedImage=e.data,b.cancelUpload();var t={message:b.uploadedImage,receiver:s.user,roomId:b.chatRoomId,type:"img"};i.sendChatMessage(t).then(function(e){m()}).catch(function(e){window.alert(e)})})},b.cancelUpload=function(){b.showTempImage=!1,b.tempImageUrl=""},b.uploadSingleImage=function(e,t){b.file=e,b.errFile=t&&t[0],e&&(b.showTempImage=!0,b.tempImageUrl=e,m())},b.leaveChatBox=function(){a.emit("removeFromRoom",{roomId:b.chatRoomId}),i.updateChatRoom(b.chatRoomId).then(function(e){console.log("update chat"),console.log(e)}).catch(function(e){console.log(e),window.alert(JSON.stringify(e))}).finally(function(){d.go("home.chat.all",{},{reload:!0})})}}e.module("petal.chat").controller("ChatBoxController",["$scope","$timeout","$ionicModal","Socket","$stateParams","userData","homeService","chatService","$ionicScrollDelegate","userService","Upload","$state",t])}(window.angular),function(e){"use strict";function t(e,t){}e.module("petal.chat").controller("ChatParentController",["$scope","$state",t])}(window.angular),function(e){"use strict";function t(t,o,n){function a(){l.params.page=1,l.chatRoomsList=[],r()}function s(){l.params.page+=1,r()}function r(){n.getRevealedChatRooms(l.params).then(function(t){console.log("Chatrroms"),console.log(t),e.forEach(t.data.docs,function(e){l.chatRoomsList.push(e)})})}var l=this;l.params={page:1,limit:25},l.chatRoomsList=[],l.getRevealedChatRooms=r,l.loadMoreChats=s,l.pullRefreshChats=a,function(){r()}()}e.module("petal.chat").controller("RevealedChatController",["$scope","$state","chatService",t])}(window.angular),function(e){"use strict";function t(e,t,o){function n(t){return console.log("chat messgae"),console.log(t),e.post(o.baseURL+"chat/create/"+t.roomId,t)}function a(t,n){return console.log("params"),console.log(n),e.get(o.baseURL+"chat/getChats/"+t,{params:n})}function s(t){return console.log("get chat room"),console.log(t),e.get(o.baseURL+"chatRoom/get/"+t)}function r(t){return t.revealed=!1,e.get(o.baseURL+"chatRoom/all/",{params:t})}function l(t){return t.revealed=!0,e.get(o.baseURL+"chatRoom/all/",{params:t})}function i(t){return e.post(o.baseURL+"chatRoom/"+t)}var c=this;c.sendChatMessage=n,c.getChatMessages=a,c.getChatRoom=s,c.getAllChatRooms=r,c.getRevealedChatRooms=l,c.updateChatRoom=i}e.module("petal.chat").service("chatService",["$http","$stateParams","homeService",t])}(window.angular),function(e){"use strict";function t(e,t){return e({prefix:"",ioSocket:io.connect(t.baseURL)})}e.module("petal.chat").factory("Socket",["socketFactory","homeService",t])}(window.angular),function(e){"use strict";function t(e,t,o){return e({prefix:"",ioSocket:io.connect(o.baseURL+t.getUser()._id)})}e.module("petal.chat").factory("SocketUserService",["socketFactory","userData","homeService",t])}(window.angular),function(e){"use strict";function t(e,t,o,n,a){function s(e){t.authenticate(e).then(function(t){window.alert("login with "+e+" successfull"),n.setUser(t.data.user),a.getUserLocation().then(function(){}).catch(function(e){window.alert(JSON.stringify(e))}).finally(function(){o.go("home.post.all")})}).catch(function(e){window.alert(JSON.stringify(e))})}function r(){t.logout(),n.removeUser(),o.go("authenticate")}var l=this;l.isAuth=t.isAuthenticated(),l.isAuth&&o.go("home.post.all"),l.authLogout=r,l.socialAuthenticate=s}e.module("petal.home").controller("AuthenticationController",["$scope","$auth","$state","userData","userLocationService",t])}(window.angular),function(e){"use strict";function t(e,t,o,n,a){function s(e){console.log(e),e.user._id==o.getUser()._id||("chatBox"==t.current.name?t.params.user!=e.user._id&&a.info("<p>"+e.user.anonName+"</p><p>"+e.message+"</p>",{allowHtml:!0,onTap:function(){t.go("chatBox",{user:e.user._id})}}):(a.info("<p>"+e.user.anonName+"</p><p>"+e.message+"</p>",{allowHtml:!0,onTap:function(){t.go("chatBox",{user:e.user._id})}}),l.badgeValue=1))}function r(){l.badgeValue="",t.go("home.chat.all")}var l=this;l.badgeValue="",l.chatClicked=r,n.on("connect",function(){n.emit("addToSingleRoom",{roomId:o.getUser()._id}),n.on("newMessageReceived",s)})}e.module("petal.home").controller("HomeController",["$scope","$state","userData","Socket","toastr",t])}(window.angular),function(e){"use strict";e.module("petal.home").directive("keepScroll",["$state","$timeout","ScrollPositions","$ionicScrollDelegate",function(e,t,o,n){return{restrict:"A",link:function(a,s,r){a.$on("$stateChangeStart",function(){o[e.current.name]=n.getScrollPosition()}),t(function(){var t;(t=o[e.current.name])&&n.scrollTo(t.left,t.top)})}}}]).factory("ScrollPositions",[function(){return{}}]).directive("isFocused",["$timeout",function(e){return{scope:{trigger:"@isFocused"},link:function(t,o){t.$watch("trigger",function(t){"true"===t&&e(function(){o[0].focus(),o.on("blur",function(){o[0].focus()})})})}}}])}(window.angular),function(e){"use strict";function t(e){this.baseURL="https://petalchat-imanjithreddy.c9users.io/"}e.module("petal.home").service("homeService",["$http",t])}(window.angular),function(e){"use strict";function t(e,t,o){}e.module("petal.home").service("userAuthService",["$http","$auth","baseUrlService","$mdDialog","userData","$window",t])}(window.angular),function(e){"use strict";function t(e,t,o,n,a){var s=e.localStorage,r={},l={setUser:function(e){if(e)s.setItem("user",JSON.stringify(e));else{var t=o.getPayload().sub;if(t)return n.get(a.baseURL+"user/get/"+t).then(function(e){console.log("response"),console.log(e),s.setItem("user",JSON.stringify(e.data))})}},getUser:function(){return JSON.parse(s.getItem("user"))},removeUser:function(){r=null,s.removeItem("user")},isUserExists:function(){return!!l.getUser()}};return l}e.module("petal.home").factory("userData",["$window","$state","$auth","$http","homeService",t])}(window.angular),function(e){"use strict";function t(t,o,n){function a(){c()}function s(){u.peopleSearchText="",u.showSearchCross=!1,c()}function r(e){u.showSearchCross=!0,e&&(u.peopleSearchText=e),c()}function l(){u.params.page+=1,i()}function i(){n.getAllUsers(u.params).then(function(t){console.log(t),e.forEach(t.data.docs,function(e){u.peopleList.push(e)}),u.initialSearchCompleted=!0,t.data.total>u.peopleList.length&&(u.canLoadMoreResults=!0)}).catch(function(e){console.log(e)}).finally(function(){t.$broadcast("scroll.refreshComplete"),t.$broadcast("scroll.infiniteScrollComplete")})}function c(){u.canLoadMoreResults=!1,u.initialSearchCompleted=!1,u.peopleList=[],u.params={limit:25,page:1},u.peopleSearchText&&(u.params.interest=u.peopleSearchText),i()}var u=this;u.getAllPeople=i,u.pullRefreshPeople=a,u.loadMorePeople=l,u.searchCrossSubmit=s,u.peopleSearchTextSubmit=r,c()}e.module("petal.people").controller("AllPeopleController",["$scope","$state","peopleService",t])}(window.angular),function(e){"use strict";function t(t,o,n){function a(){i()}function s(){c.params.page+=1,l()}function r(){i()}function l(){n.getNearbyUsers(c.params).then(function(t){console.log(t),e.forEach(t.data.docs,function(e){c.peopleList.push(e)}),c.initialSearchCompleted=!0,t.data.total>c.peopleList.length&&(c.canLoadMoreResults=!0)}).catch(function(e){console.log(e),window.alert(JSON.stringify(e))}).finally(function(){t.$broadcast("scroll.refreshComplete"),t.$broadcast("scroll.infiniteScrollComplete")})}function i(){c.canLoadMoreResults=!1,c.initialSearchCompleted=!1,c.peopleList=[],c.params={limit:25,page:1,distance:c.distance},l()}var c=this;c.getNearbyPeople=l,c.pullRefreshPeople=a,c.loadMorePeople=s,c.releaseRange=r,c.distance=10,i()}e.module("petal.people").controller("NearbyPeopleController",["$scope","$state","peopleService",t])}(window.angular),function(e){"use strict";function t(e,t){}e.module("petal.people").controller("PeopleParentController",["$scope","$state",t])}(window.angular),function(e){"use strict";function t(t,o,n){function a(){l()}function s(){i.params.page+=1,r()}function r(){n.getReceivedUsers(i.params).then(function(t){console.log("respnse"),console.log(t),e.forEach(t.data.docs,function(e){i.peopleList.push(e)}),i.initialSearchCompleted=!0,t.data.total>i.peopleList.length&&(i.canLoadMoreResults=!0)}).catch(function(e){console.log(e)}).finally(function(){t.$broadcast("scroll.refreshComplete"),t.$broadcast("scroll.infiniteScrollComplete")})}function l(){i.canLoadMoreResults=!1,i.initialSearchCompleted=!1,i.peopleList=[],i.params={limit:1,page:1},r()}var i=this;i.getReceivedPeople=r,i.pullRefreshPeople=a,i.loadMorePeople=s,l()}e.module("petal.people").controller("ReceivedPeopleController",["$scope","$state","peopleService",t])}(window.angular),function(e){"use strict";function t(t,o,n){function a(){l()}function s(){i.params.page+=1,r()}function r(){n.getRequestedUsers(i.params).then(function(t){console.log(t),e.forEach(t.data.docs,function(e){i.peopleList.push(e)}),i.initialSearchCompleted=!0,t.data.total>i.peopleList.length&&(i.canLoadMoreResults=!0)}).catch(function(e){console.log(e)}).finally(function(){t.$broadcast("scroll.refreshComplete"),t.$broadcast("scroll.infiniteScrollComplete")})}function l(){i.canLoadMoreResults=!1,i.initialSearchCompleted=!1,i.peopleList=[],i.params={limit:25,page:1},r()}var i=this;i.getRequestedPeople=r,i.pullRefreshPeople=a,i.loadMorePeople=s,l()}e.module("petal.people").controller("RequestedPeopleController",["$scope","$state","peopleService",t])}(window.angular),function(e){"use strict";function t(t,o,n){function a(){l()}function s(){i.params.page+=1,r()}function r(){n.getRevealedUsers(i.params).then(function(t){console.log("response"),console.log(t),e.forEach(t.data.docs,function(e){i.peopleList.push(e)}),i.initialSearchCompleted=!0,t.data.total>i.peopleList.length&&(i.canLoadMoreResults=!0)}).catch(function(e){console.log(e)}).finally(function(){t.$broadcast("scroll.refreshComplete"),t.$broadcast("scroll.infiniteScrollComplete")})}function l(){i.canLoadMoreResults=!1,i.initialSearchCompleted=!1,i.peopleList=[],i.params={limit:25,page:1},r()}var i=this;i.getRevealedPeople=r,i.pullRefreshPeople=a,i.loadMorePeople=s,l()}e.module("petal.people").controller("RevealedPeopleController",["$scope","$state","peopleService",t])}(window.angular),function(e){"use strict";function t(e,t,o){return{restrict:"E",templateUrl:"app/people/views/peopleListTemplate.html",scope:{peopleList:"=peopleList",peopleSearchTextSubmit:"&peopleSearchTextSubmit"},controller:["$scope",function(n){n.currentUser=o.getUser(),n.setPeopleSearch=function(e,t){n.peopleSearchTextSubmit&&(n.peopleSearchTextSubmit({interest:e}),t.stopPropagation())},e.fromTemplateUrl("app/people/views/peoplePopover.html",{scope:n}).then(function(e){n.popover=e}),n.showPopover=function(e,t){n.people=e,n.popover.show(t,n.people)},n.popOverClick=function(e,o){n.popover.hide(),"chat"==e&&t.go("chatBox",{user:o}),"profile"==e&&t.go("home.user.userPage",{user:o})}}]}}e.module("petal.people").directive("peopleList",["$ionicPopover","$state","userData",t])}(window.angular),function(e){"use strict";function t(e,t,o,n){function a(o){return o.all=!0,e.get(t.baseURL+"user/getUsers",{params:o})}function s(o){return o.revealed=!0,e.get(t.baseURL+"user/getUsers",{params:o})}function r(o){return o.received=!0,e.get(t.baseURL+"user/getUsers",{params:o})}function l(o){return o.requested=!0,e.get(t.baseURL+"user/getUsers",{params:o})}function i(a){a.nearby=!0;var s=n.defer();return o.getUserLocation().then(function(o){a.latitude=o.latitude,a.longitude=o.longitude,e.get(t.baseURL+"user/getUsers",{params:a}).then(function(e){s.resolve(e)}).catch(function(e){s.reject(e)})}).catch(function(e){s.reject(e)}),s.promise}this.getAllUsers=a,this.getRevealedUsers=s,this.getNearbyUsers=i,this.getRequestedUsers=l,this.getReceivedUsers=r,this.getNearbyUsers=i}e.module("petal.people").service("peopleService",["$http","homeService","userLocationService","$q",t])}(window.angular),function(e){"use strict";function t(e,t){function o(o){return e.get(t.baseURL+"upvote/get/"+o)}function n(o){return e.post(t.baseURL+"upvote/create/"+o)}function a(o){return e.post(t.baseURL+"upvote/delete/"+o)}this.createUpvote=n,this.deleteUpvote=a,this.getUpvote=o}e.module("petal.post").service("upvoteService",["$http","homeService",t])}(window.angular),function(e){"use strict";function t(t,o,n){function a(){c()}function s(){u.postSearchText="",u.showSearchCross=!1,c()}function r(e){u.showSearchCross=!0,e&&(u.postSearchText=e),c()}function l(){u.params.page+=1,i()}function i(){n.getAllPosts(u.params).then(function(t){e.forEach(t.data.docs,function(e){u.postsList.push(e)}),u.initialSearchCompleted=!0,t.data.total>u.postsList.length?u.canLoadMoreResults=!0:u.canLoadMoreResults=!1}).catch(function(e){window.alert(JSON.stringify(e))}).finally(function(){t.$broadcast("scroll.refreshComplete"),t.$broadcast("scroll.infiniteScrollComplete")})}function c(){u.canLoadMoreResults=!1,u.initialSearchCompleted=!1,u.postsList=[],u.params={limit:3,page:1},u.postSearchText&&(u.params.interest=u.postSearchText),i()}var u=this;u.getAllPosts=i,u.pullRefreshPosts=a,u.loadMorePosts=l,u.postSearchTextSubmit=r,u.searchCrossSubmit=s,u.params={limit:3,page:1},c()}e.module("petal.post").controller("AllPostController",["$scope","$state","postService",t])}(window.angular),function(e){"use strict";function t(e,t,o){function n(){o.submitPost(a.post).then(function(e){t.go("home.post.latest")}).catch(function(e){console.log("post error"),window.alert(JSON.stringify(e))})}var a=this;a.submitPost=n,a.post={},a.goBack=function(){window.history.back()},e.$watch(function(){return a.post.content},function(e,t){e&&e.length>300&&(a.post.content=t)})}e.module("petal.post").controller("CreatePostController",["$scope","$state","postService",t])}(window.angular),function(e){"use strict";function t(t,o,n){function a(){l()}function s(){i.params.page+=1,r()}function r(){n.getLatestPosts(i.params).then(function(t){e.forEach(t.data.docs,function(e){i.postsList.push(e)}),i.initialSearchCompleted=!0,t.data.total>i.postsList.length?i.canLoadMoreResults=!0:i.canLoadMoreResults=!1}).catch(function(e){console.log(e)}).finally(function(){t.$broadcast("scroll.refreshComplete"),t.$broadcast("scroll.infiniteScrollComplete")})}function l(){i.canLoadMoreResults=!1,i.initialSearchCompleted=!1,i.postsList=[],i.params={limit:3,page:1},r()}var i=this;i.getLatestPosts=r,i.pullRefreshPosts=a,i.loadMorePosts=s,l()}e.module("petal.post").controller("LatestPostController",["$scope","$state","postService",t])}(window.angular),function(e){"use strict";function t(t,o,n){function a(){i()}function s(){i()}function r(){c.params.page+=1,l()}function l(){n.getNearbyPosts(c.params).then(function(t){e.forEach(t.data.docs,function(e){c.postsList.push(e)}),c.initialSearchCompleted=!0,t.data.total>c.postsList.length?c.canLoadMoreResults=!0:c.canLoadMoreResults=!1}).catch(function(e){console.log(e)}).finally(function(){t.$broadcast("scroll.refreshComplete"),t.$broadcast("scroll.infiniteScrollComplete")})}function i(){c.canLoadMoreResults=!1,c.initialSearchCompleted=!1,c.postsList=[],c.params={limit:3,page:1,distance:c.distance},l()}var c=this;c.getNearbyPosts=l,c.pullRefreshPosts=a,c.loadMorePosts=r,c.releaseRange=s,c.distance=10,i()}e.module("petal.post").controller("NearbyPostController",["$scope","$state","postService",t])}(window.angular),function(e){"use strict";function t(t,o,n){function a(){l()}function s(){i.params.page+=1,r()}function r(){n.getPopularPosts(i.params).then(function(t){e.forEach(t.data.docs,function(e){i.postsList.push(e)}),i.initialSearchCompleted=!0,t.data.total>i.postsList.length?i.canLoadMoreResults=!0:i.canLoadMoreResults=!1}).catch(function(e){console.log(e)}).finally(function(){t.$broadcast("scroll.refreshComplete"),t.$broadcast("scroll.infiniteScrollComplete")})}function l(){i.canLoadMoreResults=!1,i.initialSearchCompleted=!1,i.postsList=[],i.params={limit:3,page:1},r()}var i=this;i.getPopularPosts=r,i.pullRefreshPosts=a,i.loadMorePosts=s,l()}e.module("petal.post").controller("PopularPostController",["$scope","$state","postService",t])}(window.angular),function(e){"use strict";function t(e,t){}e.module("petal.post").controller("PostParentController",["$scope","$state",t])}(window.angular),function(e){"use strict";function t(e,t,o,n,a,s){function r(){o.getPost(n.id).then(function(e){p.post=e.data,p.distanceObj={latitude:p.post.loc[1],longitude:p.post.loc[0],diatance:0},u()})}function l(){s.getUpvote(p.currentPost).then(function(e){p.postUpvoted=e.data||!1}).catch(function(e){console.log(e)})}function i(){s.createUpvote(p.currentPost).then(function(e){l()}).catch(function(e){console.log(e)})}function c(){s.deleteUpvote(p.currentPost).then(function(e){l()}).catch(function(e){console.log(e)})}function u(){o.getDistance(p.distanceObj)}var p=this;p.getSinglePost=r,p.submitPostUpvote=i,p.deletePostUpvote=c,p.getPostDistance=u,p.back=function(){window.history.back()},function(){p.currentPost=n.id,r(),l()}()}e.module("petal.post").controller("SinglePostController",["$scope","$state","postService","$stateParams","$ionicHistory","upvoteService",t])}(window.angular),function(e){"use strict";function t(e,t,o,n,a,s){return{restrict:"E",templateUrl:"app/post/views/postsListTemplate.html",scope:{postsList:"=postsList",postSearchTextSubmit:"&postSearchTextSubmit"},controller:["$scope",function(r){function l(e){t.go("home.user.userPage",{user:e}),r.modal&&r.modal.hide()}function i(){c(),u()}function c(){n.getPost(r.postModal.id).then(function(e){r.postModal.post=e.data,r.postModal.distanceObj={latitude:r.postModal.post.loc[1],longitude:r.postModal.post.loc[0],diatance:0},h()})}function u(){a.getUpvote(r.postModal.id).then(function(e){r.postModal.postUpvoted=e.data,console.log("post upvote"),console.log(e),console.log(r.postModal.postUpvoted)}).catch(function(e){console.log("check error"),console.log(e)})}function p(){a.createUpvote(r.postModal.id).then(function(e){u(),console.log("check submit"),console.log(e)}).catch(function(e){console.log("submit error"),console.log(e)})}function d(){a.deleteUpvote(r.postModal.id).then(function(e){u(),console.log("delete "),console.log(e)}).catch(function(e){console.log("delete error"),console.log(e)})}function h(){n.getDistance(r.postModal.distanceObj)}!function(){s.fromTemplateUrl("app/post/views/postModal.html",{scope:r}).then(function(e){r.modal=e})}(),r.getTime=function(e){return moment(e).fromNow(!0)},r.currentUser=o.getUser(),r.setPostSearch=function(e){r.postSearchTextSubmit&&r.postSearchTextSubmit({interest:e})},e.fromTemplateUrl("app/people/views/peoplePopover.html",{scope:r}).then(function(e){r.popover=e}),r.showPopover=function(e,t){r.posts=e,r.popover.show(t,r.posts)},r.popOverClick=function(e,o){r.popover.hide(),"chat"==e&&t.go("chatBox",{user:o}),"profile"==e&&r.postModal.userPage(o)},r.postModal={},r.postModal.userPage=l,r.postModal.getSinglePost=c,r.postModal.submitPostUpvote=p,r.postModal.deletePostUpvote=d,r.postModal.getPostDistance=h,r.showPostModal=function(e){r.postModal.id=e,i(),r.modal.show()}}]}}e.module("petal.post").directive("postsList",["$ionicPopover","$state","userData","postService","upvoteService","$ionicModal",t])}(window.angular),function(e){"use strict";function t(e,t,o,n,a,s,r,l,i,c){function u(){a.setUser().then(function(){w.user=a.getUser(),e.editForm.user=w.user,w.user.interests.length&&(e.editForm.user.interests="!"+w.user.interests.join("!"))})}function p(){w.params={page:1,limit:100,user:a.getUser()._id},c.getAllPosts(w.params).then(function(e){w.postsList=e.data.docs})}function d(e){w.activeTab=e}function h(e){return e===w.activeTab}function f(){s.fromTemplateUrl("app/user/views/userEditForm.html",{scope:e}).then(function(t){e.editForm.modal=t})}function m(){o.logout(),t.go("authenticate")}function g(){u(),e.editForm={},f(),v(),e.$broadcast("scroll.refreshComplete"),p()}function v(){l.getRequestedUsers({page:1,limit:25}).then(function(e){w.peopleList=e.data.docs,w.total=e.data.total})}var w=this;w.logout=m,w.activate=g,w.activeTab=1,w.activateTab=d,w.isTabActive=h,g(),e.editForm.submitUser=function(){r.updateUser(e.editForm.user).then(function(){window.alert("updated user"),e.editForm.modal.hide()})},e.editForm.uploadUserPicture=function(t,o){e.loadingImage=!0,w.file=t,w.errFile=o&&o[0],t&&(w.file.upload=i.upload({url:n.baseURL+"upload/singleUpload",data:{file:w.file}}),w.file.upload.then(function(t){w.file.result=t.data,e.editForm.user.picture=t.data,e.loadingImage=!1}))}}e.module("petal.user").controller("UserMePageController",["$scope","$state","$auth","homeService","userData","$ionicModal","userService","peopleService","Upload","postService",t])}(window.angular),function(e){"use strict";function t(e,t,o,n,a,s,r,l){function i(){w.params={page:1,limit:100,user:a.user},l.getAllPosts(w.params).then(function(e){w.postsList=e.data.docs})}function c(e){w.activeTab=e}function u(e){return e===w.activeTab}function p(){s.show({titleText:"Reveal",buttons:[{text:'<i class="icon ion-share"></i> Send Reveal Request'}],cancelText:"Cancel",cancel:function(){},buttonClicked:function(e){return n.initiate(a.user).then(function(e){m()}).catch(function(e){window.alert(JSON.stringify(e))}),!0}})}function d(){s.show({titleText:"Reveal",buttons:[{text:'<i class="icon ion-share"></i> Delete Reveal Request'}],cancelText:"Cancel",cancel:function(){console.log("CANCELLED")},buttonClicked:function(e){return n.cancel(a.user).then(function(e){m()}).catch(function(e){window.alert(JSON.stringify(e))}),!0}})}function h(){s.show({titleText:"Reveal",buttons:[{text:'<i class="icon ion-share"></i> Accept Reveal Request'},{text:'<i class="icon ion-share"></i> Deny Reveal Request'}],cancelText:"Cancel",cancel:function(){console.log("CANCELLED")},buttonClicked:function(e){return 0===e?n.accept(a.user).then(function(e){m()}).catch(function(e){window.alert(JSON.stringify(e))}):1===e&&n.ignore(a.user).then(function(e){m()}).catch(function(e){window.alert(JSON.stringify(e))}),!0}})}function f(){s.show({titleText:"Reveal",buttons:[{text:'<i class="icon ion-share"></i> Delete Reveal '}],cancelText:"Cancel",cancel:function(){console.log("CANCELLED")},buttonClicked:function(e){return 0===e&&n.finish(a.user).then(function(e){m()}).catch(function(e){window.alert(JSON.stringify(e))}),!0}})}function m(){n.check(a.user).then(function(e){w.revealChoice=e.data})}function g(){window.history.back()}function v(){o.getUser(a.user).then(function(e){w.user=e.data})}var w=this;w.sendReveal=p,w.cancelReveal=d,w.decideReveal=h,w.deleteReveal=f,w.checkReveal=m,w.goBack=g,w.activateTab=c,w.isTabActive=u,function(){v(),w.revealChoice=r,w.activeTab=1,i()}()}e.module("petal.user").controller("UserPageController",["$state","$auth","userService","revealService","$stateParams","$ionicActionSheet","friends","postService",t])}(window.angular),function(e){"use strict";function t(e,t,o){alert(o)}e.module("petal.user").controller("UserPagePostsController",["$state","$stateParams","friends",t])}(window.angular),function(e){"use strict";function t(e,t,o){}e.module("petal.user").controller("UserParentController",["$state","$auth","userData",t])}(window.angular),function(e){"use strict";function t(e,t){function o(e){return{secondUser:e}}function n(o){return e.post(t.baseURL+"reveal/initiate",{secondUser:o})}function a(o){return e.post(t.baseURL+"reveal/accept",{secondUser:o})}function s(o){return e.post(t.baseURL+"reveal/ignore",{secondUser:o})}function r(o){return e.post(t.baseURL+"reveal/cancel",{secondUser:o})}function l(n){var a=o(n);return e.get(t.baseURL+"reveal/received",{params:a})}function i(n){var a=o(n);return e.get(t.baseURL+"reveal/requested",{params:a})}function c(n){var a=o(n);return e.get(t.baseURL+"reveal/revealed",{params:a})}function u(o){return e.post(t.baseURL+"reveal/finish",{secondUser:o})}function p(n){var a=o(n);return e.get(t.baseURL+"reveal/check",{params:a})}this.initiate=n,this.accept=a,this.ignore=s,this.cancel=r,this.received=l,this.requested=i,this.revealed=c,this.finish=u,this.check=p}e.module("petal.user").service("revealService",["$http","homeService",t])}(window.angular),function(e){"use strict";function t(e,t){function o(){var o={timeout:1e4,enableHighAccuracy:!1};return e.getCurrentPosition(o).then(function(e){var o={latitude:e.coords.latitude,longitude:e.coords.longitude};return t.updateUser(o),o})}this.getUserLocation=o}
e.module("petal.user").service("userLocationService",["$cordovaGeolocation","userService",t])}(window.angular),function(e){"use strict";function t(e,t){function o(o){return e.get(t.baseURL+"user/get/"+o)}function n(o){return e.post(t.baseURL+"user/update/",{user:o})}this.updateUser=n,this.getUser=o}e.module("petal.user").service("userService",["$http","homeService",t])}(window.angular),function(e){"use strict";function t(e,t,o,n){function a(o){return e.get(t.baseURL+"post/getPosts",{params:o})}function s(a){a.nearby=!0;var s=n.defer();return o.getUserLocation().then(function(o){a.latitude=o.latitude,a.longitude=o.longitude,e.get(t.baseURL+"post/getPosts",{params:a}).then(function(e){s.resolve(e)}).catch(function(e){s.reject(e)})}).catch(function(e){s.reject(e)}),s.promise}function r(o){return o.sort="-time",e.get(t.baseURL+"post/getPosts",{params:o})}function l(o){return o.sort="-upvotesLength",e.get(t.baseURL+"post/getPosts",{params:o})}function i(a){var s=n.defer();return o.getUserLocation().then(function(o){a.latitude=o.latitude,a.longitude=o.longitude,e.post(t.baseURL+"post/create",{post:a}).then(function(e){s.resolve(e)}).catch(function(e){s.reject(e)})}).catch(function(o){alert("errr"),window.alert(JSON.stringify(o)),e.post(t.baseURL+"post/create",{post:a}).then(function(e){console.log("inside service catch"),console.log(e),s.resolve(e)}).catch(function(e){s.reject(e)})}),s.promise}function c(o){return e.delete(t.baseURL+"post/delete/"+o)}function u(o){return e.get(t.baseURL+"post/get/"+o)}function p(e){var t=e.latitude,n=e.longitude;o.getUserLocation().then(function(o){var a=o.latitude,s=o.longitude,r=d(a-t),l=d(s-n),i=Math.sin(r/2)*Math.sin(r/2)+Math.cos(d(t))*Math.cos(d(a))*Math.sin(l/2)*Math.sin(l/2),c=2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)),u=6371*c;e.distance=Math.ceil(u)}).catch(function(e){console.log(e)})}function d(e){return e*(Math.PI/180)}this.getAllPosts=a,this.getNearbyPosts=s,this.getLatestPosts=r,this.getPopularPosts=l,this.submitPost=i,this.deletePost=c,this.getPost=u,this.getDistance=p}e.module("petal.post").service("postService",["$http","homeService","userLocationService","$q",t])}(window.angular);